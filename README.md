# PAYHERE
기간 : 2023.04.11 ~ 2023.04.16
<hr>


### 🏗 프로젝트 아키텍쳐   
![Payhere 아키텍쳐 이미지](https://user-images.githubusercontent.com/81751267/232327900-44563bdc-937c-4083-b252-b75a37f77159.png)
- JWT Refresh Token 관리를 위해 Redis를 활용하였습니다.
- 로그인, JWT 활용 편의성을 위해 Spring Security를 적용하였습니다.
- 서버 : Java 1.8 / Spring Boot 2.7.10
- Data : MySQL 5.7 / Redis
- JPA (Hibernate), Spring Security, JWT 등으로 개발하였습니다.
<hr>

### ▶ 실행 방법
- 프로젝트 Root 디렉토리 명령 프롬프트(터미널)에서 다음 커맨드를 입력합니다. 
```java
docker-compose up --build -d
```

<br>
<hr>

### ⚙ ERD
![payhere](https://user-images.githubusercontent.com/81751267/232324349-95900ed1-af6e-4a36-8386-51c3ef6a04d9.png)
#### ERD 링크 : [ERDcloud](https://www.erdcloud.com/p/wjhHtxyw3y8Ae7dSk)

### ⚙ ERD 설계 코멘트

- **상품 테이블 초성 이름 필드**   
    상품 등록, 수정 시 해당 상품의 초성을 분리하여 저장하는 필드입니다.
    초성 검색을 위해 JPA 함수를 2가지로 분리하여 초성 검색인 경우 초성 이름 필드에서, 단어 검색인 경우 이름을 기준으로 탐색합니다.
    또한, SQL쿼리를 사용하여 매 쿼리 마다 함수를 적용하는 법을 고려할 수 있습니다.
<br>

- **회원과 상품 테이블의 구성**   
    요구사항 상으로는 식별관계로 지정하여 PK를 활용함으로서 데이터 정합성과 인덱스의 이점을 가질 수 있습니다.   
    하지만 서비스의 확장 시 사업장, 주문 등의 테이블이 회원과 상품 테이블 사이에 위치할 수 있고, 프렌차이즈 운영이나   
    공동 사장의 구현 등 시스템의 변경이 필요한 상황에 테이블 확장의 가능성이 아주 높아서 필수적 비식별 1 : N 관계로 구성하였습니다.
<br>

- **각 테이블의 기본 키로 INT와 BIGINT 타입을 사용**   
    상품 데이터가 많이 쌓일 것이라 판단하여 BIGINT로 설정하였습니다.   
    보안이나 데이터베이스 분산 시 고유성을 고려하여 회원과 상품 데이터의 기본 키를 UUID로 지정하는 방법도 있습니다.   
    하지만 현재 요구사항을 기준으로 서비스의 환경이나 처리속도와 id 노출 시 보안 위험 사이의 경중을 판단하기 어려워 보류하였습니다.   
<br>

- **Member Entity 구분**   
    Member와 Owner를 상속관계로 두어 다양한 유형의 회원을 만들 수 있도록 하였습니다.  
<br>

- **크기 지정 및 기타**   
    - 회원타입(DTYPE)은 JPA 사용 시 Entity 상속관계로 파생된 필드입니다.
    - 회원 ROLE 테이블은 Spring Security로 인하여 파생된 테이블입니다. Role과 Member의 관계를 맵핑합니다.
    - 상품의 바코드의 형식이 명시되어 있지 않기 때문에, 일반적인 규약에 따라 공용 숫자 13자리 혹은 14자리를 기준으로 설정하였습니다.
    - 유통기한이 앞으로 남은 N일을 의미하는지, XX월 XX일 XX시 XX분을 의미하는지 확실하지 않아 정확한 기한을 표시할 수 있는 후자를 택하였습니다.
    - 사이즈는 요구 명세에 small or large이므로 true/false로 db에 저장하는 것을 고려했으나, 사이즈 추가로 변경이 필요할 수 있어 VARCHAR(5)로 설정하였습니다.
    - 요구사항이 특정되지 않은 문자열 필드는 VARCHAR의 짧게 나타낼 수 있는 크기 중 가장 큰 255를 설정합니다.   
    - 상품 설명은 1000자로 가정하였습니다.   
<br>

<hr>

### 🗝 API 및 테스트 케이스   
#### [Postman](https://documenter.getpostman.com/view/15539771/2s93XyU3uj)
Postman을 통해 테스트하고 정리하였습니다. 상단 링크를 클릭하면 이동합니다.
<br>

<hr>

### 🧪 고민해 볼 점 및 후기   

- **UUID 활용**   
이번 과제에서는 Auto Increment 값을 Key로 사용하고 그 값을 기준으로 데이터를 교환하는 단순한 과정을 적용하였지만, 그러한 관점에서 벗어나 보안이나 확장성 면에서 고려할 점이 많다고 느꼈습니다.
서비스의 목적을 기준으로 어느 정도까지 클라이언트에게 드러낼지, 서비스를 Scale-out하거나 DB 확장을 위해 분산이나 샤딩이 필요한지 등, 서비스의 복잡도가 올라갈수록 각 프로세스가 갖는 장단점을 바탕으로 확장성, 성능, 서비스 환경까지 판단하여 활용하기 어려워짐을 느꼈습니다.   
<br>

- **테스트 코드 작성**   
API 호출을 테스트하기 위해 Postman이나 필요한 클라이언트 역할을 하는 더미 서버를 만드는 것이 전부였습니다. 그러나 이번 기회에 약간의 단위 테스트 코드를 처음 작성해보면서, 훨씬 더 테스트 코드의 필요성을 느낄 수 있었습니다.
<br>

- **Domain 영역의 분리**   
DTO나 Entity들을 만들어서 활용하는 것뿐만 아니라, 각 요소가 어떤 영역에서 어떠한 의도를 갖고 활용하기 위해 구현하는 것인지 다시 한번 생각해보는 기회였습니다.
Setter나 생성자에도 주의가 필요하고, 프로젝트 내부 수많은 위치에서 데이터의 변경을 유발할 수 있는 엔드포인트를 열어두는 것이 좋지 못하다는 점도 알게 되었습니다.
또한, 속성을 변경할 때도 자유로운 Setter를 사용하기보다, 내부에 메소드를 구현하여 메소드 이름만으로도 어떻게 동작하는지 알 수 있게 의도적으로 생성할 필요가 있었습니다.

<br>

- **로그인, 회원가입 시 보안 취약성**   
JPA Repository를 통해 입력 값을 DB에 저장하면 직접적인 보안 공격에 대한 취약성이 낮아지지만, 여전히 입력 값을 그대로 활용하면 취약점이 될 수 있습니다. 이러한 취약점으로부터 XSS나 SQL Injection과 같은 공격으로부터 안전하게 대비하기 위한 방법을 고려하지 못한 것이 아쉽습니다.
<br>

- **JPA, ORM**   
이전에 팀 프로젝트를 진행하면서 Django에서 ORM을 활용할 수 있었지만, 편의성을 느끼기 전에 직접 Query를 작성하여 활용하는 경우가 많았습니다.   
이번 기회를 통해 ORM을 좀 더 활용해 볼 수 있었고, 기본적인 데이터베이스 영역보다 개발에 집중할 수 있었습니다.   
그러나 쿼리가 복잡해질수록 단점도 더 많아지기 때문에 이에 주의해야 합니다.
<br>


<hr>

### 💧 프로젝트 디렉토리   
```java
├─gradle
│  └─wrapper
└─src
    ├─main
    │  ├─java
    │  │  └─com
    │  │      └─spamallday
    │  │          └─payhere
    │  │              ├─auth
    │  │              ├─configuration
    │  │              ├─controller
    │  │              ├─dto
    │  │              ├─entity
    │  │              ├─enums
    │  │              ├─exception
    │  │              ├─repository
    │  │              ├─service
    │  │              └─util
    │  └─resources
    └─test
        └─java
            └─com
                └─spamallday
                    └─payhere
                        └─domain
```
<br>
